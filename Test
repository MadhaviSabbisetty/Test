<Autocomplete
  value={branch}
  options={Array.isArray(branchList) ? branchList : []}
  loading={branchLoading}
  disabled={!circle}
  getOptionLabel={(o) =>
    o?.branchCode ? `${o.branchCode} - ${o.branchName}` : ""
  }
  isOptionEqualToValue={(o, v) =>
    o?.branchCode === v?.branchCode
  }
  onChange={(e, v) => setBranch(v)}
  renderInput={(params) => (
    <TextField
      {...params}
      label="Select Branch"
      InputProps={{
        ...params.InputProps,
        endAdornment: (
          <>
            {branchLoading && <CircularProgress size={18} />}
            {params.InputProps.endAdornment}
          </>
        ),
      }}
    />
  )}
  ListboxProps={{
    style: { maxHeight: 300, overflow: "auto" },
  }}
  renderOption={(props, option) => (
    <li {...props}>
      {option.branchCode} - {option.branchName}
    </li>
  )}
  renderGroup={(params) => (
    <>
      {params.children}

      {branchHasMore && !branchLoading && (
        <li
          style={{
            textAlign: "center",
            padding: "8px",
            cursor: "pointer",
            fontWeight: 500,
            color: "#1976d2",
          }}
          onMouseDown={(e) => e.preventDefault()} // ðŸ”´ VERY IMPORTANT
          onClick={() =>
            fetchBranches(circle, branchSize + 20)
          }
        >
          Show more branchesâ€¦
        </li>
      )}
    </>
  )}
/>




const fetchBranches = async (circle, size = 20) => {
  if (!circle?.circleCode || branchLoading) return;

  try {
    setBranchLoading(true);

    const res = await callApi(
      `/CM/common-master/indian-foreign-branches?circleCode=${circle.circleCode}&size=${size}`,
      null,
      "GET"
    );

    const branches = Array.isArray(res?.data?.data?.data)
      ? res.data.data.data
      : [];

    setBranchList(branches);
    setBranchHasMore(branches.length === size);
    setBranchSize(size);
  } catch (e) {
    console.error(e);
    setBranchList([]);
  } finally {
    setBranchLoading(false);
  }
};
