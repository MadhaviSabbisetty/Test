@PostMapping("/fetch-report-types")
public ResponseEntity<?> fetchReportTypes(@RequestBody Map<String, Object> requestBody) {
    // We use Object to allow the service to return whatever JSON comes from the Report Service
    Object response = commonMasterService.getReportTypesFromReportService(requestBody);
    
    if (response == null) {
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                             .body("Error: Report Service is unreachable or returned an error.");
    }
    
    return ResponseEntity.ok(response);
}







public interface CommonMasterService {
    // Changed from List to Object to support flexible JSON responses
    Object getReportTypesFromReportService(Map<String, Object> body);
}






@Override
public Object getReportTypesFromReportService(Map<String, Object> body) {
    // Ensure this IP and Port match your running Report Service
    String reportServiceUrl = "http://10.0.19.37:9005/api/reports/types";

    try {
        log.info("Contacting Report Service at: {}", reportServiceUrl);

        HttpHeaders headers = new HttpHeaders();
        // The secret key allows us to bypass the JWT filter on the Report Service
        headers.set("X-Internal-Service-Key", "FincoreSecret123");
        headers.setContentType(MediaType.APPLICATION_JSON);

        HttpEntity<Map<String, Object>> entity = new HttpEntity<>(body, headers);

        // Using Object.class is safer than List.class when the response structure is unknown
        ResponseEntity<Object> response = restTemplate.postForEntity(
            reportServiceUrl, 
            entity, 
            Object.class
        );

        return response.getBody();

    } catch (Exception e) {
        log.error("REST CALL FAILED: {}", e.getMessage());
        return null;
    }
}
