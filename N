const downloadReportOutsideReact = ({
  payload,
  onProgress,
  onSuccess,
  onError,
}) => {
  axios
    .post("/RS/reports/download", payload, {
      responseType: "blob",
      onDownloadProgress: onProgress,
    })
    .then((response) => {
      if (response.data && response.data.size > 22) {
        const contentDisposition =
          response.headers["content-disposition"] ||
          response.headers["Content-Disposition"];

        let filename = "report.zip";
        if (contentDisposition?.includes("filename")) {
          const match = contentDisposition.match(/filename="(.+?)"/);
          if (match?.[1]) filename = match[1];
        }

        const url = window.URL.createObjectURL(response.data);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        onSuccess?.(filename);
      } else {
        onError?.("No reports found matching your criteria");
      }
    })
    .catch(() => {
      onError?.("Download failed");
    });
};



downloadReportOutsideReact({
  payload,
  onProgress: (event) => {
    if (event?.loaded) {
      setIsDownloading(true);
      setDownloadedBytes(event.loaded);
    }
  },
  onSuccess: (filename) => {
    showSnackBar(
      `Reports "${filename}" downloaded successfully`,
      "success"
    );
    setIsLoading(false);
    setIsDownloading(false);
    setDownloadedBytes(0);
  },
  onError: (msg) => {
    showSnackBar(msg, "error");
    setIsLoading(false);
    setIsDownloading(false);
    setDownloadedBytes(0);
  },
});
