const handleFetchReportData = () => {
  if (!selectedReport?.fileName || !selectedDate) return;

  if (dateError) {
    showSnackBar(getErrorMessage(dateError), "error");
    return;
  }

  // Create a hidden form
  const form = document.createElement("form");
  form.method = "POST";
  form.action = "/RS/reports/download";
  form.style.display = "none";

  // IMPORTANT: keep same tab so cookies/session are preserved
  form.target = "_self";

  const fields = {
    moduleType: moduleType,
    fileName: selectedReport.fileName,
    date: selectedDate.format("YYYY-MM-DD"),
    roleId: user.role,
  };

  Object.entries(fields).forEach(([key, value]) => {
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = key;
    input.value = value;
    form.appendChild(input);
  });

  document.body.appendChild(form);
  form.submit();
  form.remove();

  showSnackBar("Download started. It will continue in background.", "info");
};
